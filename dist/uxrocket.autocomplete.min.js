/**
 * UX Rocket
 * jQuery based accordion
 * @author Bilal Cinarli
 * @dependency jQueryUI Autocomplete
 * @dependency Handlebars
 * @dependency UX Rocket Clear
 */
;(function($){var k,defaults={type:"list",item:10,service:null,minLength:2,formdata:null,serialize:'String',categoryTextLimit:25,queryType:'GET',hidden:null,template:null,highlight:true,arrowSelection:false,arrowNavigation:true,cache:false,tabSelect:false,onReady:false,onSelect:false,onButtonClick:false,onClearCache:false,onUpdate:false,onRemove:false},templates={list:{wrap:'<ul></ul>',item:''+'<li>'+'   <a {{#if url}}href="{{url}}"{{/if}}>'+'       {{{name}}}'+'       {{#if title}}'+'       <br /><em>{{substr title 50}}</em>'+'       {{/if}}'+'   </a>'+'</li>'},image:{wrap:'<ul></ul>',item:''+'<li>'+'   <a {{#if url}}href="{{url}}"{{/if}}>'+'       <span class="item-image"><img src="{{image}}"/></span> '+'       {{{name}}}'+'       {{#if title}}'+'       <br /><em>{{substr title 50}}</em>'+'       {{/if}}'+'   </a>'+'</li>'},category:{wrap:'<ul></ul>',head:''+'<li class="uxitd-autocomplete-category ui-autocomplete-category">'+'   <span class="uxitd-category-head" title="{{category}}">{{substr category 25}}</span>'+'</li>',item:''+'<li>'+'   <a {{#if url}}href="{{url}}"{{/if}}>'+'       {{{name}}}'+'       {{#if title}}'+'       <br /><em>{{substr title 50}}</em>'+'       {{/if}}'+'   </a>'+'</li>'},tree:{wrap:'<ul></ul>',head:''+'<li class="uxitd-autocomplete-category ui-autocomplete-category">'+'   <span class="uxitd-category-head" title="{{category}}">{{substr category 25}}</span>'+'</li>',item:''+'<li>'+'   <a {{#if url}}href="{{url}}"{{/if}}>'+'       <span class="item-image"><img src="{{image}}"/></span> '+'       {{{name}}}'+'       {{#if title}}'+'       <br /><em>{{substr title 50}}</em>'+'       {{/if}}'+'   </a>'+'</li>'}},events={click:'click.uxAutocomplete',search:'autocompletesearch.uxAutocomplete',response:'autocompleteresponse.uxAutocomplete',keydown:'keydown.uxAutocomplete'},ns={rocket:'uxRocket',data:'uxAutocomplete',ready:'uxitd-autocomplete-ready',rocketWrap:'uxitd-plugin-wrap',wrap:'uxitd-autocomplete-wrap',icon:'icon-search',loading:'icon-loading'};var l=function(a,b,c){var d=$(a),opts=$.extend({},defaults,b,d.data(),{'selector':c});opts.terms={};d.data(ns.data,opts);m(d);r(opts.onReady);o(d);p(d)};var m=function(a){var b,_opts=a.data(ns.data);b=' '+a.context.className.replace(ns.ready,'');if(_opts.selector.charAt(0)=='.'){b=b.replace(' '+_opts.selector.substr(1),'');b=b.replace(_opts.selector.substr(1)+' ','')}if(a.parent().is('.'+ns.rocketWrap)){a.parent().addClass(ns.wrap+b+' group')}else{a.wrap('<span class="'+ns.rocketWrap+' '+ns.wrap+b+' group"></span>')}a.after('<i class="'+ns.icon+'"></i>')};var n=function(h){var i=h.data(ns.data),fdata=null,url_pattern=/^(http|https|\/|\.\/|\.\.\/)/,source=i.service,sourceFunction;if(!url_pattern.test(source)||typeof source==="object"){if(typeof source==="string"){source=eval(source)}var j=source.itemList||source;sourceFunction=function(b,c){if(!h.is(':focus')){return}var d=new RegExp($.ui.autocomplete.escapeRegex(b.term),"i");c($.map(j,function(a){if(d.test(a.name)){return q(a)}}))}}else{sourceFunction=function(d,e){var f=d.term;if(!h.is(':focus')){return}if(i.cache&&f in i.terms){var g=i.terms[f].itemList||i.terms[f];e($.map(g.slice(0,i.item),function(a){return q(a)}));return}if(i.formdata!=null){fdata=i.serialize==='String'?$(i.formdata).serialize():$(i.formdata)['serialize'+i.serialize]()}$.ajax({url:source,dataType:'json',type:i.queryType,data:{type:i.type,term:f,formdata:fdata},success:function(b){if(i.cache){i.terms[f]=b;h.data(ns.data,i)}var c=b.itemList||b;e($.map(c.slice(0,i.item),function(a){return q(a)}))}})}}return sourceFunction};var o=function(f){var g=f.data(ns.data);if(typeof g.props!=='undefined'&&g.props!=''){var h=g.props.split(':');f.next('.'+ns.icon).addClass('uxitd-autocomplete-icon-clickable').on(events.click,function(e){e.preventDefault();eval(h[1])})}if(g.onButtonClick!==false){f.next('.'+ns.icon).on(events.click,function(){r(g.onButtonClick)})}f.on(events.search,function(a,b){$(this).siblings('.'+ns.icon).addClass(ns.loading)});f.on(events.response,function(a,b){$(this).siblings('.'+ns.loading).removeClass(ns.loading)});if(g.tabSelect===true){f.on(events.keydown,function(b){var c=b.keyCode||b.which;if(c==9){var d=f.data("ui-autocomplete");var e=new RegExp("^"+$.ui.autocomplete.escapeRegex(f.val())+"$","i");d.widget().children(".ui-menu-item").each(function(){var a=$(this).data("ui-autocomplete-item");if(e.test(a.label||a.value||a)){d.selectedItem=a;return false}});if(d.selectedItem){d._trigger("select",b,{item:d.selectedItem});f.val(d.selectedItem.label)}}})}f.autocomplete({open:function(a,b){$(".uxitd-autocomplete-category").removeClass('ui-menu-item');$(this).autocomplete("widget").css({"width":($(this).outerWidth()+"px")})},minLength:g.minLength,source:n(f),focus:function(a,b){if(!g.arrowNavigation){a.preventDefault()}},select:function(a,b){if(g.hidden!=null){$(g.hidden).val(b.item.id)}if(g.arrowSelection===true&&a.keyCode==13&&typeof b.item.url!=='undefined'){var c=$("#"+a.currentTarget.id).find(".ui-state-focus a").attr("target");if(c=='_blank'){window.open(b.item.url)}else{window.location=b.item.url}}r(g.onSelect)}})};var p=function(h){var i=h.data("uiAutocomplete")?h.data("uiAutocomplete"):h.data("ui-autocomplete"),_opts=h.data(ns.data),template={};if(_opts.template===null){switch(_opts.type){default:case'list':template=templates.list;break;case'image':template=templates.image;break;case'category':template=templates.category;break;case'tree':template=templates.tree;break}}else{template=_opts.template}i._renderMenu=function(e,f){var g=this,_list=[],currentCategory="";$.each(f,function(a,b){var c;if((_opts.type=='category'||_opts.type=='tree')&&typeof b.category!=='undefined'&&b.category!=currentCategory){var d=Handlebars.compile(template.head)(b);_list.push(d);currentCategory=b.category}c=g._renderItemData(e,b);_list.push(c)});e.append(_list);if(currentCategory!=""){e.addClass('uxitd-category')}};i._create=function(){var a=this;a._super();a.widget().menu("option","items","> :not(.ui-autocomplete-category)")};i._renderItemData=function(a,b){var c,listItem=Handlebars.compile(template.item)(b);c=listItem;if(_opts.highlight===true){c=listItem.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+$.ui.autocomplete.escapeRegex(this.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),'<span class="matched">$1</span>')}return $(c).addClass('ui-menu-item').data("ui-autocomplete-item",b).attr('role','presentation')}};var q=function(a){if(typeof a.value==='undefined'){a.value=a.name}if(typeof a.visiblename!=='undefined'){a.value=a.visiblename}return a};$.fn.serializeObject=function(){var a={},_a=this.serializeArray();$.each(_a,function(){if(a[this.name]){if(!a[this.name].push){a[this.name]=[a[this.name]]}a[this.name].push(this.value||'')}else{a[this.name]=this.value||''}});return a};var r=function(a){if(typeof a==='function'){a.apply(this)}else{if(a!==false){var b=new Function('return '+a);b()}}};k=$.fn.uxitdautocomplete=$.uxautocomplete=function(b){var c=this.selector;return this.each(function(){var a=$(this),uxrocket=a.data('uxRocket')||{},autocomplete;if(a.hasClass(ns.ready)||a.hasClass(ns.rocketWrap)){return}a.addClass(ns.ready);uxrocket[ns.data]={'hasWrapper':true,'wrapper':ns.wrap,'ready':ns.ready,'selector':c,'options':b};a.data(ns.rocket,uxrocket);autocomplete=new l(this,b,c)})};k.clearCache=function(b){var c=b!==undefined?$(b):$("."+ns.ready);c.filter('input').each(function(){var a=$(this),_instance=a.data(ns.data);_instance.terms={};a.data(ns.data,_instance);r(_instance.onClearCache)})};k.update=function(b){var c=b!==undefined?$(b):$("."+ns.ready);c.filter('input').each(function(){var a=$(this),_instance=a.data(ns.data),_rocket=a.data(ns.rocket);a.autocomplete('destroy');a.removeData(ns.data);_instance=$.extend({},defaults,_rocket[ns.data]['options'],$(this).data());a.data(ns.data,_instance);a.off(events.click+' '+events.search+' '+events.response);o(a);p(a);r(_instance.onUpdate)})};k.remove=function(b){var c=b!==undefined?$(b):$("."+ns.ready);c.filter('input').each(function(){var a=$(this),_instance=a.data(ns.data),_uxrocket=a.data(ns.rocket);a.removeClass(ns.ready);a.off(events.click+' '+events.search+' '+events.response);a.next('.'+ns.icon).remove();if(_uxrocket[ns.data].hasWrapper){if(Object.keys&&Object.keys(_uxrocket).length==1){a.unwrap()}else{a.parent().removeClass(ns.wrap)}}a.removeData(ns.data);delete _uxrocket[ns.data];a.data(ns.rocket,_uxrocket);a.autocomplete('destroy');r(_instance.onRemove)})};k.version='1.9.1';k.settings=defaults})(jQuery);